<UserControl x:Class="CoachingCenterApp.Views.Shared.Sidebar"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:CoachingCenterApp.Helpers">

	<UserControl.Resources>
		<converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
		<!-- Expanded/Collapsed Style -->
		<Style TargetType="TreeViewItem" BasedOn="{StaticResource MaterialDesignTreeViewItem}">
			<Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
			<Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="Padding" Value="8 4"/>
		</Style>

		<!-- Menu Item Template -->
		<HierarchicalDataTemplate x:Key="MenuItemTemplate" ItemsSource="{Binding Children}">
			<StackPanel Orientation="Horizontal">
				<!-- Modified icon with fallback -->
				<materialDesign:PackIcon
					Kind="{Binding Icon}"
					Width="20"
					Visibility="{Binding Icon, Converter={StaticResource NullToVisibilityConverter}}"/>
				<TextBlock Text="{Binding Title}" Margin="10 0 0 0"/>
			</StackPanel>
		</HierarchicalDataTemplate>
	</UserControl.Resources>

	<Border Background="{DynamicResource MaterialDesignPaper}">
		<Grid>
			<!-- Nested Menu -->
			<TreeView ItemsSource="{Binding MenuItems}"
					ItemTemplate="{StaticResource MenuItemTemplate}"
					Background="Transparent"
					BorderThickness="0">
				<TreeView.ItemContainerStyle>
					<Style TargetType="TreeViewItem"
						  BasedOn="{StaticResource {x:Type TreeViewItem}}">
						<Setter Property="Margin" Value="0 4"/>
					</Style>
				</TreeView.ItemContainerStyle>
			</TreeView>
		</Grid>
	</Border>
</UserControl>